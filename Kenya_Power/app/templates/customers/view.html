{% extends "base.html" %}

{% block title %}{{ customer.full_name }} - Kenya Power{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h4 class="mb-0">{{ customer.full_name }}</h4>
  <div>
    <a href="{{ url_for('customers.edit_customer', customer_id=customer.customer_id) }}" class="btn btn-outline-primary me-2">
      <i class="bi bi-pencil"></i> Edit
    </a>
    <a href="{{ url_for('customers.list_customers') }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Back
    </a>
  </div>
</div>

<div class="row">
  <div class="col-lg-4">
    <!-- Customer Info Card -->
    <div class="card mb-4">
      <div class="card-header">Customer Information</div>
      <div class="card-body">
        <div class="text-center mb-3">
          <div class="rounded-circle bg-primary bg-opacity-10 p-4 d-inline-block">
            <i class="bi bi-person-circle text-primary" style="font-size: 3rem;"></i>
          </div>
        </div>
        <h5 class="text-center">{{ customer.full_name }}</h5>
        <p class="text-center text-muted mb-3">{{ customer.account_number }}</p>

        <hr>

        <div class="mb-2">
          <i class="bi bi-telephone text-muted me-2"></i>
          {{ customer.phone }}
        </div>
        {% if customer.email %}
        <div class="mb-2">
          <i class="bi bi-envelope text-muted me-2"></i>
          {{ customer.email }}
        </div>
        {% endif %}
        <div class="mb-2">
          <i class="bi bi-credit-card text-muted me-2"></i>
          {{ customer.id_number }}
        </div>
        <div class="mb-2">
          <i class="bi bi-geo-alt text-muted me-2"></i>
          {{ customer.address }}, {{ customer.town }}, {{ customer.county }}
        </div>

        <hr>

        <div class="d-flex justify-content-between">
          <span class="text-muted">Type:</span>
          <span class="badge bg-info">{{ customer.customer_type.title() }}</span>
        </div>
        <div class="d-flex justify-content-between mt-2">
          <span class="text-muted">Status:</span>
          {% if customer.is_active %}
          <span class="badge bg-success">Active</span>
          {% else %}
          <span class="badge bg-secondary">Inactive</span>
          {% endif %}
        </div>
        <div class="d-flex justify-content-between mt-2">
          <span class="text-muted">Registered:</span>
          <span>{{ customer.registration_date.strftime('%b %d, %Y') }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-8">
    <!-- Connections -->
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Connections</span>
        <a href="{{ url_for('connections.add_connection') }}?customer_id={{ customer.customer_id }}" class="btn btn-sm btn-primary">
          <i class="bi bi-plus"></i> Add Connection
        </a>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
            <tr>
              <th>Meter No.</th>
              <th>Type</th>
              <th>Capacity</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for conn in connections %}
            <tr>
              <td>{{ conn.meter_number }}</td>
              <td>{{ conn.connection_type.replace('_', ' ').title() }}</td>
              <td>{{ conn.load_capacity }} kVA</td>
              <td><span class="badge status-{{ conn.connection_status }}">{{ conn.connection_status.title() }}</span></td>
              <td>
                <a href="{{ url_for('connections.view_connection', connection_id=conn.connection_id) }}" class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-eye"></i>
                </a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="text-center py-3 text-muted">No connections found</td>
            </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Recent Service Requests -->
    <div class="card">
      <div class="card-header">Recent Service Requests</div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Type</th>
              <th>Status</th>
              <th>Date</th>
            </tr>
            </thead>
            <tbody>
            {% for req in service_requests %}
            <tr>
              <td>#{{ req.request_id }}</td>
              <td>{{ req.request_type.replace('_', ' ').title() }}</td>
              <td><span class="badge status-{{ req.status }}">{{ req.status.replace('_', ' ').title() }}</span></td>
              <td>{{ req.submitted_date.strftime('%b %d, %Y') }}</td>
            </tr>
            {% else %}
            <tr>
              <td colspan="4" class="text-center py-3 text-muted">No service requests</td>
            </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}