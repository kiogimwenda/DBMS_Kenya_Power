{% extends "base.html" %}

{% block title %}Maintenance Calendar - Kenya Power{% endblock %}

{% block extra_css %}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h4 class="mb-0">Maintenance Calendar</h4>
  <div>
    <a href="{{ url_for('maintenance.list_maintenance') }}" class="btn btn-outline-secondary me-2">
      <i class="bi bi-list-ul"></i> List View
    </a>
    {% if current_user.role in ['admin', 'manager'] %}
    <a href="{{ url_for('maintenance.schedule_maintenance') }}" class="btn btn-primary">
      <i class="bi bi-plus-circle"></i> Schedule Maintenance
    </a>
    {% endif %}
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div id="calendar"></div>
  </div>
</div>

<!-- Legend -->
<div class="card mt-4">
  <div class="card-body">
    <div class="d-flex gap-4 flex-wrap">
      <div class="d-flex align-items-center">
        <span class="badge me-2" style="background-color: #3788d8;">&nbsp;&nbsp;&nbsp;</span>
        <span>Scheduled</span>
      </div>
      <div class="d-flex align-items-center">
        <span class="badge me-2" style="background-color: #f39c12;">&nbsp;&nbsp;&nbsp;</span>
        <span>In Progress</span>
      </div>
      <div class="d-flex align-items-center">
        <span class="badge me-2" style="background-color: #27ae60;">&nbsp;&nbsp;&nbsp;</span>
        <span>Completed</span>
      </div>
      <div class="d-flex align-items-center">
        <span class="badge me-2" style="background-color: #e74c3c;">&nbsp;&nbsp;&nbsp;</span>
        <span>Cancelled</span>
      </div>
      <div class="d-flex align-items-center">
        <span class="badge me-2" style="background-color: #9b59b6;">&nbsp;&nbsp;&nbsp;</span>
        <span>Postponed</span>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          headerToolbar: {
              left: 'prev,next today',
              center: 'title',
              right: 'dayGridMonth,timeGridWeek,listWeek'
          },
          events: '{{ url_for("maintenance.get_events") }}',
          eventClick: function(info) {
              window.location.href = info.event.url;
          },
          height: 'auto'
      });
      calendar.render();
  });
</script>
{% endblock %}